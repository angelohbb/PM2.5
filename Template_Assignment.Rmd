---
title: "PM2.5 East and West Europe"
author: "Studentnames and studentnumbers here"
date: "`r Sys.Date()`"
output: pdf_document
---

# Set-up your environment

```{r package_install, include=FALSE}
#install.packages("tidyverse")
#install.packages("yaml")
#install.packages("rmarkdown")
```

```{r packages}
require(tidyverse)
require(rmarkdown)
require(yaml)
```

# Title Page

Jusab Aziz, Angelo Habib, Abba Ayad

Include the tutorial group number

Include your tutorial lecturer's name

# Part 1 - Identify a Social Problem

Use APA referencing throughout your document. [Here's a link to some explanation.](https://www.mendeley.com/guides/apa-citation-guide/)

## 1.1 Describe the Social Problem

Include the following:

-   Why is this relevant?

-   ...

# Part 2 - Data Sourcing

## 2.1 Load in the data

Preferably from a URL, but if not, make sure to download the data and store it in a shared location that you can load the data in from. Do not store the data in a folder you include in the Github repository!

```{r loading_data, include=FALSE}
# STEP 2.1 — Load in the Starting Data

# Load required packages
library(dplyr)
library(readxl)

# ----------------------------
# Load East Europe Data
# ----------------------------
east_base_path <- "~/Documents/GitHub/PM2.5/data/east europe data/"

read_tsv_utf16_east <- function(filename, year) {
  path <- paste0(east_base_path, filename)
  df <- read.delim(path, fileEncoding = "UTF-16LE", sep = "\t", check.names = TRUE)
  df$Year <- year
  df <- df[, !duplicated(names(df))]  # remove duplicated columns
  return(df)
}

east_2018 <- read_tsv_utf16_east("2018.csv", 2018)
east_2019 <- read_tsv_utf16_east("2019.csv", 2019)
east_2020 <- read_tsv_utf16_east("2020.csv", 2020)
east_2021 <- read_tsv_utf16_east("2021.csv", 2021)
east_2022 <- read_tsv_utf16_east("2022.csv", 2022)
east_2023 <- read_tsv_utf16_east("2023.csv", 2023)


# ----------------------------
# Load West Europe Data
# ----------------------------
west_base_path <- "~/Documents/GitHub/PM2.5/data/west europe data/"

read_tsv_utf16_west <- function(filename, year) {
  path <- paste0(west_base_path, filename)
  df <- read.delim(path, fileEncoding = "UTF-16LE", sep = "\t", check.names = TRUE)
  df$Year <- year
  df <- df[, !duplicated(names(df))]
  return(df)
}

west_2018 <- read_tsv_utf16_west("2018 west.csv", 2018)
west_2019 <- read_tsv_utf16_west("2019 west.csv", 2019)
west_2020 <- read_tsv_utf16_west("2020 west.csv", 2020)
west_2021 <- read_tsv_utf16_west("2021 west.csv", 2021)
west_2022 <- read_tsv_utf16_west("2022 west.csv", 2022)
west_2023 <- read_tsv_utf16_west("2023 west.csv", 2023)


# ----------------------------
# Load Mortality (Premature Deaths) Dataset
# ----------------------------
mortality_excel_path <- path.expand("~/Documents/GitHub/PM2.5/sdg_11_52_page_spreadsheet-3.xlsx")

df_mortality_raw <- read_excel(mortality_excel_path, skip = 9)

```

### Merging

```{r}


all_data_east <- bind_rows(
  east_2018, east_2019, east_2020,
  east_2021, east_2022, east_2023
)
all_data_west <- bind_rows(
  west_2018, west_2019, west_2020,
  west_2021, west_2022, west_2023
)

```

## 2.2 Provide a short summary of the dataset(s)

```{r}
# Show structure of each raw dataset
head(all_data_east)
head(all_data_west)
head(df_mortality_raw)

```

The "all_data_east" and "all_data_west" datasets contain yearly air pollution data for each country. Each row represents one country in a specific year (from 2018 to 2023). The variables include PM2.5 concentration, number of monitoring stations, threshold exceedances, and other environmental indicators. A "Year" column was added manually to keep track of the time dimension.

The "df_mortality_raw" dataset shows the estimated number of premature deaths attributed to PM2.5 pollution. It is structured in wide format, with countries in the rows and years (e.g., 2016–2021) as column headers. Each value represents the total number of premature deaths for that country in a given year.

## 2.3 Describe the type of variables included

#### **1. Air Pollution Datasets (all_data_east, all_data_west)**

The [air pollution datasets](https://www.eea.europa.eu/en/analysis/maps-and-charts/air-quality-statistics-dashboards) provide annual, country-level environmental data for the years 2018 to 2023. Most variables are numerical and describe air quality levels, monitoring activity, and regulatory exceedances.

**Key variables include:**

-   **PM2.5 concentration**: The annual average level of fine particulate matter in the air, measured in micrograms per cubic meter (µg/m³).

-   **Number of monitoring stations**: The total number of stations reporting valid data per country and year.

-   **Threshold exceedances**: The number of instances where measured pollution levels exceeded legal EU air quality thresholds.

-   **Population exposure**: In some years, indicators report the proportion of the population exposed to levels above legal limits.

-   **Country**: The name of the reporting country.

-   **Year**: The calendar year of the observation (manually added).

**Data source and collection method:**\
These data are collected through official **air quality monitoring stations** managed by national environmental authorities. The values are compiled and standardized by the **European Environment Agency (EEA)**. All data are obtained from administrative or sensor-based sources, not from individuals or surveys.

#### **2. Mortality Dataset (df_mortality_raw)**

[The mortality data set contains](https://ec.europa.eu/eurostat/databrowser/view/sdg_11_52/default/table) health outcome estimates related to air pollution exposure. It presents the number of premature deaths attributable to PM2.5 per country and year, based on modelled estimates.

**Key variables include:**

-   **TIME**: Country name.

-   **Year columns (e.g., 2016–2021)**: Each year column represents the total number of estimated premature deaths for that country and year.

**Data source and collection method:**\
This data set originates from the United Nations Sustainable Development Goals (SDG) indicator database, specifically SDG 11.6.2. The figures are not directly observed but are produced using statistical models that combine environmental exposure, population demographics, and epidemiological data. As such, these are administrative and model-based estimates, not derived from individual-level surveys or medical records.

# Part 3 - Quantifying

## 3.1 Data cleaning

Say we want to include only larger distances (above 2) in our dataset, we can filter for this.

```{r data_cleaning}
# Add Region
all_data_east$Region <- "East"
all_data_west$Region <- "West"

# Ensure both have 'Threshold.1' column
if (!"Threshold.1" %in% colnames(all_data_east)) {
  all_data_east$Threshold.1 <- NA_character_
}
if (!"Threshold.1" %in% colnames(all_data_west)) {
  all_data_west$Threshold.1 <- NA_character_
}

# Force 'Threshold.1' to character in both
all_data_east$Threshold.1 <- as.character(all_data_east$Threshold.1)
all_data_west$Threshold.1 <- as.character(all_data_west$Threshold.1)

# Align both datasets to shared columns
common_cols <- intersect(names(all_data_east), names(all_data_west))
all_data_east <- all_data_east[, common_cols]
all_data_west <- all_data_west[, common_cols]

```

Please use a separate 'R block' of code for each type of cleaning. So, e.g. one for missing values, a new one for removing unnecessary variables etc.

#### Merging

```{r}
# Combine
combined_data <- bind_rows(all_data_east, all_data_west)
```

## Data cleaning

```{r}
library(janitor)
df_combined_clean <- combined_data %>%
  clean_names() %>%
  mutate(across(where(is.character), str_trim)) %>%
  mutate(across(where(is.character), ~na_if(., "")))

message("Cleaned Combined dataset: ", nrow(df_combined_clean), " rows × ", ncol(df_combined_clean), " columns")


```

## Data cleaning (average of cities PM2.5)

```{r}
# Compute average PM2.5 by country, region, and year
avg_pm25_by_country_year <- df_combined_clean %>%
  group_by(country, region, year_of_statistics) %>%
  summarise(average_pm25 = mean(air_pollution_level, na.rm = TRUE), .groups = "drop") %>%
  arrange(year_of_statistics, region, country)

```

## Data cleaning (mortality)

```{r}
df_mortality_clean <- df_mortality_raw %>%
  rename(country = TIME) %>%
  pivot_longer(
    cols = -country,
    names_to = "year_of_statistics",
    values_to = "premature_deaths",
    values_drop_na = TRUE
  ) %>%
  mutate(
    year_of_statistics = as.integer(year_of_statistics),
    premature_deaths = as.numeric(premature_deaths)
  )

```

## 3.2 Generate necessary variables

Variable 1

```{r gen_var1}

```

Variable 2

```{r gen_var2}

```

### Merging final

```{r}
merged_data <- full_join(df_mortality_clean, avg_pm25_by_country_year, by = c("year_of_statistics", "country")
)

```

## 3.3 Visualize temporal variation

```{r}

```

## 3.4 Visualize spatial variation

```{r visualise_map}

```

Here you provide a description of why the plot above is relevant to your specific social problem.

## 3.5 Visualize sub-population variation

What is the poverty rate by state?

```{r visualise_subpopulations}
dataset$inmetro <- dataset$inmetro %>% as.factor()
# Boxplot of poverty rate by state using the 'midwest' dataset
ggplot(dataset, aes(x = inmetro, y = percadultpoverty)) +
  geom_boxplot() +
  labs(
    title = "Distribution of Poverty Rates by Metropolitan status (Midwest counties)",
    x = "Metropolitan Area",
    y = "Poverty Rate of Adults (%)"
  ) +
  theme_minimal() +
  theme(
    legend.position = "right"
  )
```

Here you provide a description of why the plot above is relevant to your specific social problem.

## 3.6 Event analysis

Analyze the relationship between two variables.

```{r analysis}

```

Here you provide a description of why the plot above is relevant to your specific social problem.

# Part 4 - Discussion

## 4.1 Discuss your findings

Our analysis reveals a clear regional divide in air quality and its impact on public health across Europe, specifically when comparing Eastern and Western Europe.

First, the spatial analysis shows that Eastern European countries consistently have higher average PM2.5 levels than Western European countries. Countries like Poland, Romania, Bulgaria, and Hungary showed the most concerning pollution levels. In contrast, France, Germany, and Ireland had much lower PM2.5 concentrations. This supports the hypothesis that air pollution is geographically uneven across Europe, and suggests that factors such as outdated industrial infrastructure, energy production methods, and less stringent environmental policies in the East contribute to this discrepancy.

Second, the temporal analysis from 2018 to 2022 shows a general decline in PM2.5 levels, reaching a low point in 2020. This dip likely correlates with the COVID-19 pandemic, during which lockdowns reduced transportation and industrial emissions. However, the rebound in 2021 indicates that these reductions were temporary, and that without long-term policy changes, improvements in air quality may not be sustained. This emphasizes the need for permanent structural interventions rather than relying on short-term events.

Third, the subgroup analysis highlights the public health consequences of this pollution. Eastern European countries not only have higher PM2.5 levels but also show significantly higher mortality rates related to air pollution. For instance, Bulgaria, Romania, and Poland exhibit more than 150 deaths per 100,000 people, whereas Western European countries like France, Belgium, and Austria report less than half that amount. This strongly suggests that higher pollution directly correlates with higher health risks, and it highlights the urgent need for targeted health and environmental policies in Eastern Europe.

In conclusion, our findings support the idea that PM2.5 pollution is both an environmental and a social issue, with unequal health outcomes across Europe. Tackling this problem requires coordinated policy efforts, especially in Eastern Europe, focusing on clean energy, industrial modernization, and public health investment. Without addressing these disparities, the health impacts of air pollution will continue to disproportionately affect populations in the East.

# Part 5 - Reproducibility

## 5.1 Github repository link

Provide the link to your PUBLIC repository here: ...

## 5.2 Reference list

World Health Organization. (2021). Air pollution: Health impacts. <https://www.who.int/health-topics/air-pollution#tab=tab_1>

\
